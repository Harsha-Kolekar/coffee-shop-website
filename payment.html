<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Coffee Shop</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .payment-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .payment-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .payment-header h1 {
            color: var(--text-color);
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .payment-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }
        
        .order-summary {
            background: rgba(255, 255, 255, 0.05);
            border: 0.1rem solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 2rem;
        }
        
        .order-summary h2 {
            color: var(--text-color);
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .order-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 0.1rem solid rgba(255, 255, 255, 0.1);
        }
        
        .order-item img {
            width: 60px;
            height: 60px;
            border-radius: 0.5rem;
            object-fit: cover;
        }
        
        .order-item-details {
            flex: 1;
        }
        
        .order-item-name {
            color: var(--text-color);
            font-weight: bold;
            margin-bottom: 0.3rem;
        }
        
        .order-item-options {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }
        
        .order-item-price {
            color: var(--main-color);
            font-weight: bold;
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 0.1rem solid rgba(255, 255, 255, 0.2);
            font-size: 1.5rem;
            color: var(--text-color);
        }
        
        .payment-form {
            background: rgba(255, 255, 255, 0.05);
            border: 0.1rem solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 2rem;
        }
        
        .payment-form h2 {
            color: var(--text-color);
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            color: var(--text-color);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border: 0.1rem solid rgba(255, 255, 255, 0.2);
            background: var(--bg-color);
            color: var(--text-color);
            border-radius: 0.5rem;
            font-size: 1.1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
        }
        
        .payment-methods {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .payment-method {
            flex: 1;
            padding: 1rem;
            border: 0.1rem solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .payment-method:hover {
            border-color: var(--main-color);
        }
        
        .payment-method.selected {
            border-color: var(--main-color);
            background: rgba(255, 215, 0, 0.1);
        }
        
        .payment-method i {
            font-size: 2rem;
            color: var(--main-color);
            margin-bottom: 0.5rem;
        }
        
        .payment-method span {
            display: block;
            color: var(--text-color);
            font-size: 1rem;
        }
        
        .btn-pay {
            width: 100%;
            padding: 1.2rem;
            background: var(--main-color);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.3rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-pay:hover {
            background: #c8a97e;
        }
        
        .btn-pay:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .payment-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .payment-methods {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <a href="#" class="logo">coffee <i class="fas fa-mug-hot"></i></a>
        <nav class="navbar">
            <a href="index.html">home</a>
            <a href="#about">about</a>
            <a href="#menu">menu</a>
            <a href="#review">review</a>
            <a href="#book">book</a>
        </nav>
        <div class="icons">
            <div class="fas fa-search" id="search-btn"></div>
            <div class="fas fa-shopping-cart" id="cart-btn"></div>
            <div class="fas fa-bars" id="menu-btn"></div>
        </div>
    </header>

    <!-- Payment Container -->
    <div class="payment-container">
        <div class="payment-header">
            <h1>Secure Checkout</h1>
            <p style="color: #999;">Complete your order details and payment</p>
        </div>

        <div class="payment-content">
            <!-- Order Summary -->
            <div class="order-summary">
                <h2>Order Summary</h2>
                <div id="orderItems">
                    <!-- Order items will be populated here -->
                </div>
                <div class="order-total">
                    <span>Total:</span>
                    <span id="orderTotal">$0.00</span>
                </div>
            </div>

            <!-- Payment Form -->
            <div class="payment-form">
                <h2>Payment Information</h2>
                
                <form id="paymentForm">
                    <!-- Delivery Information -->
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" required placeholder="John Doe">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" required placeholder="john@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" required placeholder="+1234567890">
                    </div>
                    
                    <div class="form-group">
                        <label for="address">Delivery Address</label>
                        <input type="text" id="address" required placeholder="123 Main St, City, State">
                    </div>
                    
                    <!-- Payment Method -->
                    <div class="form-group">
                        <label>Payment Method</label>
                        <div class="payment-methods">
                            <div class="payment-method selected" data-method="card">
                                <i class="fas fa-credit-card"></i>
                                <span>Credit Card</span>
                            </div>
                            <div class="payment-method" data-method="paypal">
                                <i class="fab fa-paypal"></i>
                                <span>PayPal</span>
                            </div>
                            <div class="payment-method" data-method="cash">
                                <i class="fas fa-money-bill"></i>
                                <span>Cash on Delivery</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card Details (shown for card payment) -->
                    <div id="cardDetails">
                        <div class="form-group">
                            <label for="cardNumber">Card Number</label>
                            <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expiryDate">Expiry Date</label>
                                <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" placeholder="123" maxlength="3">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-pay" id="payButton">
                        Complete Payment
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <section class="footer">
        <div class="box-container">
            <div class="box">
                <h3>our branches</h3>
                <a href="#"><i class="fas fa-arrow-right"></i> india</a>
                <a href="#"><i class="fas fa-arrow-right"></i> USA</a>
                <a href="#"><i class="fas fa-arrow-right"></i> france</a>
                <a href="#"><i class="fas fa-arrow-right"></i> africa</a>
                <a href="#"><i class="fas fa-arrow-right"></i> japan</a>
            </div>
            <div class="box">
                <h3>quick links</h3>
                <a href="index.html"><i class="fas fa-arrow-right"></i> home</a>
                <a href="#about"><i class="fas fa-arrow-right"></i> about</a>
                <a href="#menu"><i class="fas fa-arrow-right"></i> menu</a>
                <a href="#review"><i class="fas fa-arrow-right"></i> review</a>
                <a href="#book"><i class="fas fa-arrow-right"></i> book</a>
            </div>
            <div class="box">
                <h3>contact info</h3>
                <a href="#"><i class="fas fa-phone"></i> +123-456-7890</a>
                <a href="#"><i class="fas fa-phone"></i> +111-222-3333</a>
                <a href="#"><i class="fas fa-envelope"></i> coffee@gmail.com</a>
                <a href="#"><i class="fas fa-envelope"></i> Perú, Lima</a>
            </div>
            <div class="box">
                <h3>contact info</h3>
                <a href="#"><i class="fab fa-facebook-f"></i> facebook</a>
                <a href="#"><i class="fab fa-twitter"></i> twitter</a>
                <a href="#"><i class="fab fa-instagram"></i> instagram</a>
                <a href="#"><i class="fab fa-linkedin"></i> linkedin</a>
                <a href="#"><i class="fab fa-twitter"></i> twitter</a>
            </div>
        </div>
        <div class="credit">created by <span>mr. web designer</span> | all rights reserved</div>
    </section>

    <script>
        // Payment page functionality
        class PaymentPage {
            constructor() {
                this.orderId = this.getOrderIdFromURL();
                this.order = null;
                this.selectedPaymentMethod = 'card';
                this.init();
            }

            init() {
                this.loadOrder();
                this.bindEvents();
                this.loadUserInfo();
            }

            getOrderIdFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('orderId');
            }

            loadOrder() {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                this.order = orders.find(o => o.id === this.orderId);
                
                if (!this.order) {
                    alert('Order not found');
                    window.location.href = 'index.html';
                    return;
                }

                this.displayOrderSummary();
            }

            displayOrderSummary() {
                const orderItems = document.getElementById('orderItems');
                const orderTotal = document.getElementById('orderTotal');

                orderItems.innerHTML = this.order.items.map(item => `
                    <div class="order-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="order-item-details">
                            <div class="order-item-name">${item.name}</div>
                            <div class="order-item-options">
                                ${item.size.charAt(0).toUpperCase() + item.size.slice(1)}
                                ${item.addons.length > 0 ? ' + ' + item.addons.map(a => a.replace('-', ' ')).join(', ') : ''}
                                × ${item.quantity}
                            </div>
                            <div class="order-item-price">$${item.totalPrice.toFixed(2)}</div>
                        </div>
                    </div>
                `).join('');

                orderTotal.textContent = `$${this.order.total.toFixed(2)}`;
            }

            loadUserInfo() {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                if (user.email) {
                    document.getElementById('email').value = user.email;
                }
                if (user.name) {
                    document.getElementById('fullName').value = user.name;
                }
            }

            bindEvents() {
                // Payment method selection
                document.querySelectorAll('.payment-method').forEach(method => {
                    method.addEventListener('click', () => {
                        document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                        method.classList.add('selected');
                        this.selectedPaymentMethod = method.dataset.method;
                        this.toggleCardDetails();
                    });
                });

                // Form submission
                document.getElementById('paymentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.processPayment();
                });

                // Card number formatting
                document.getElementById('cardNumber').addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\s/g, '');
                    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                    e.target.value = formattedValue;
                });

                // Expiry date formatting
                document.getElementById('expiryDate').addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 2) {
                        value = value.slice(0, 2) + '/' + value.slice(2, 4);
                    }
                    e.target.value = value;
                });

                // CVV validation
                document.getElementById('cvv').addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '');
                });
            }

            toggleCardDetails() {
                const cardDetails = document.getElementById('cardDetails');
                if (this.selectedPaymentMethod === 'card') {
                    cardDetails.style.display = 'block';
                    document.getElementById('cardNumber').required = true;
                    document.getElementById('expiryDate').required = true;
                    document.getElementById('cvv').required = true;
                } else {
                    cardDetails.style.display = 'none';
                    document.getElementById('cardNumber').required = false;
                    document.getElementById('expiryDate').required = false;
                    document.getElementById('cvv').required = false;
                }
            }

            validateForm() {
                const fullName = document.getElementById('fullName').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const address = document.getElementById('address').value.trim();

                if (!fullName || !email || !phone || !address) {
                    this.showNotification('Please fill in all delivery information', 'error');
                    return false;
                }

                if (this.selectedPaymentMethod === 'card') {
                    const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
                    const expiryDate = document.getElementById('expiryDate').value;
                    const cvv = document.getElementById('cvv').value;

                    if (cardNumber.length !== 16) {
                        this.showNotification('Please enter a valid card number', 'error');
                        return false;
                    }

                    if (!expiryDate.match(/^\d{2}\/\d{2}$/)) {
                        this.showNotification('Please enter a valid expiry date (MM/YY)', 'error');
                        return false;
                    }

                    if (cvv.length !== 3) {
                        this.showNotification('Please enter a valid CVV', 'error');
                        return false;
                    }
                }

                return true;
            }

            async processPayment() {
                if (!this.validateForm()) {
                    return;
                }

                const payButton = document.getElementById('payButton');
                payButton.disabled = true;
                payButton.textContent = 'Processing...';

                // Simulate payment processing
                setTimeout(() => {
                    // Update order status
                    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                    const orderIndex = orders.findIndex(o => o.id === this.orderId);
                    
                    if (orderIndex !== -1) {
                        orders[orderIndex].status = 'paid';
                        orders[orderIndex].paymentMethod = this.selectedPaymentMethod;
                        orders[orderIndex].deliveryInfo = {
                            fullName: document.getElementById('fullName').value,
                            email: document.getElementById('email').value,
                            phone: document.getElementById('phone').value,
                            address: document.getElementById('address').value
                        };
                        orders[orderIndex].paidAt = new Date().toISOString();
                        
                        localStorage.setItem('orders', JSON.stringify(orders));
                    }

                    this.showNotification('Payment successful! Your order has been placed.', 'success');
                    
                    setTimeout(() => {
                        window.location.href = 'order-confirmation.html?orderId=' + this.orderId;
                    }, 2000);
                }, 2000);
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 1rem 1.5rem;
                    background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                    color: white;
                    border-radius: 0.5rem;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    z-index: 10001;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }

        // Initialize payment page when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new PaymentPage();
        });

        // Add fadeOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(100px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
